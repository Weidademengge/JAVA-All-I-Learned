本文是基础研发部的Linux新人手册系列文章的第一篇，旨在介绍Linux系统的一些基本概念，分析和解释常用命令和惯用方法背后的逻辑，使得每一个同学在后续的工作过程中能够更为快捷的进行开发、测试和调试。

# Linux 是什么？

Linux是一种自由和开放源代码的类UNIX操作系统，在服务器领域有这广泛的应用。它的独特优点在于开源和可定制化，可以满足不同硬件平台和不同设计目的的需求。有关于Linux的介绍在Google上非常的多，本文就不多赘述了。

# Linux 基本哲学

Linux哲学是一套基于Linux操作系统顶级开发者们的经验提出的软件开发的准则和哲学，Linux有着与常用的Windows截然不同的哲学理念，这些理念也影响了Linux上相应的程序的设计思想和使用方式。

## 一切皆文件

“一切皆文件”，指的是对所有文件（目录、字符设备、块设备、套接字、打印机等）操作，读写都可用fopen()/fclose()/fwrite()/fread()等函数进行处理，屏蔽了硬件的区别，所有设备都抽象成文件，提供统一的接口给用户。虽然类型各不相同，但是对其提供的却是同一套操作接口。一些常见的文件如：  
- 目录：我们可以用vim 打开“/”根目录或/home去查看其中的信息；Linux下所有文件都是从根目录延伸出去的；  
- 设备：如随机数生成器在系统中以文件/dev/urandom存在，可以使用head等命令去访问；  
- 系统配置：系统中的配置信息也是存储在文本文件，如文件/etc/passwd记录了系统内所有账号的基本信息；  
- 进程信息：可以从/proc/cpuinfo中查看到cpu的信息；通过/proc/PID/cwd来查看进程PID的运行目录；

## 单一目的的命令

单一目的指的是每个命令尽量只负责完成一件事情、并尽可能实现的很完善(do one thing and do it well)，常用的命令有：  
- 目录遍历：ls  
- 输出文本内容：cat、tac、head、tail等  
- 字符串输出：echo、printf  
- 文件查找：find  
- 字符串查找：grep

## 组合命令完成大任务

在实际使用时，难免会用到需要完成一些复杂功能的场景，如“找到行数超过1000的源代码文件的路径”，这些功能可以通过上述命令的组合来完成。命令组合时一个关键点是所有程序的输入输出都是文本，这一点和“一切皆文件”密切相关。组合过程中需要涉及到如下功能；  
- 管道符：在Linux中，管道（Pipeline）是一系列将标准输入输出链接起来的手段，其中每一个进程的输出被直接作为下一个进程的输入。使用时，类似于” command1 | command2 paramater1 | command3 parameter1”，管道符"|"将前面命令的stdout导向后续命令的stdin中。管道在执行时不涉及到中间文件；  
- 重定向：重定向是指将程序的stdin、stdout和stderr重定向到其他文件中，而不是原始的标准输入输出；使用时，类似"ls > ls.log 2> ls.err"即可将ls命令的执行结果保存到文件ls.log、并将错误信息保存到ls.err文件中。常用的还有追加写入">>"和输入重定向"<"；  
- Shell脚本：Shell脚本可以粗略理解为一些命令顺序执行的脚本文件，详细内容在后续章节有介绍；

# 文本编辑Vim

常言道：工欲善其事，必先利其器 ，作为一个程序员，一个常用的工具就是编辑器。Vim是一个著名的功能强大、高度可定制的文本编辑器，在Vi的基础上改进和增加了很多特性。Vim有着非常陡峭的学习曲线，甚至有几个冷笑话

_“如何生成随机数？让一个新手退出Vim”  
__“我已经用了两年Vim了，因为我一直没能退出”。_

由于网上的入门教程极多，本文不在赘述Vim的各种概念和快捷键等，推荐阅读《简明 VIM 练级攻略[https://coolshell.cn/articles/5426.html](https://coolshell.cn/articles/5426.html) 》来学习基本使用(“:q”可以退出Vim)。

# Shell脚本

Shell是用来处理操作系统和用户交互的一个程序。Shell的脚本可以帮助用户自动化地和操作系统进行交互。可以理解为一种脚本式的编程预研。即然有编程，那么，程序的编写、运行和调试就必不可少了，下面咱们分别介绍一下这几个过程：

## 编写

首先，要明确shell是指一种应用程序，这个应用程序提供了一个界面，用户通过这个界面访问操作系统内核的服务。常用的有ash, bash, csh, tcsh, dash, zsh等。用这些软件来解析和执行Shell命令和相应的脚本。可以通过which来查看具体使用的版本(which sh)。  
Shell脚本（shell script），是一种为shell编写的脚本程序。通常是文本文件、以.sh作为文件名后缀的方式存储在磁盘上。  
下面，以一个例子来介绍Shell脚本的语法：

![](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/128606/1676513833801-e4bea00c-b1a5-4210-9f58-3b84c0cf8ccd.png)

_第1行，指定了这个脚本默认的解释器；_  
_第2行，从#开始都行尾，都是注释。为了程序的可读性，请尽量多写注释；_  
_第6行，通过一个if语句来判断输入参数是否合法(有且仅有一个参数)，不合法则输出帮助信息并退出程序；_  
_第13~14行，指定了变量path，并赋予了初值'。注意，在中1′。注意，在shell中′+字符串'表明为变量，此处'表明是第一个输入参数；此处的变量后续可以通过1′表明是第一个输入参数；此处的变量path后续可以通过′path'来使用；_  
_第18行，用for循环来遍历每一个文件。注意，文件列表是通过$(cmd…)的方式、以执行子程序find的方式得到的；_  
_第20行，再次使用子程序得到每一个文件的行数；_  
_第22行，判断行数是否满足要求，满足则进入then分支输出；_  
_第26~28行，将for循环内的输出传递给sort，按照第二列(-k 2)进行排序；_  
_第30行，清理现场。建议使用"/tmp/."作为临时文件的前缀，可以有效避免清理时出现遗漏或误删除；_

## 运行

编写完Shell脚本后(如run.sh)，运行就比较简单了：  
- 方案A：“sh run.sh /usr/include”。直接调用sh程序来读取并执行run.sh，可以使用你选定的其他shell程序运行；  
- 方案B：“ chmod +x run.sh ; run.sh /usr/include”。先chmod给脚本加上执行权限，然后直接执行。此时会使用第1行指定的解释器去读取和运行；

## 调试

调试Shell脚本也很方便，可以使用shell的"-x"选项。"-x"选项是调试shell脚本的强有力工具，它使shell在执行脚本的过程中把实际执行的每一个命令显示出来，并且在行首显示一个"+"号以区分，"+"号后面显示的是经过了变量替换之后的命令行的内容，有助于分析实际执行的是什么命令。"-x"选项使用起来简单方便，可以轻松对付大多数的shell调试任务，应把其当作首选的调试手段。  
实际使用时，只需要执行"sh -x run.sh /usr/include"，shell会在运行前打印出每一行实际执行的命令(所有变量都会替换)。如下图：

![](https://intranetproxy.alipay.com/skylark/lark/0/2023/png/128606/1676513919809-6a55fb3c-69ef-4bb0-9718-8de1c4f0516b.png)

# 环境变量

环境变量是在操作系统中一个具有特定名字的对象，它包含了一个或多个应用程序将使用到的信息。Linux是一个多用户的操作系统，每个用户登录系统时都会有一个专用的运行环境，通常情况下每个用户的默认的环境都是相同的。这个默认环境就是一组环境变量的定义。每个用户都可以通过修改环境变量的方式对自己的运行环境进行配置。

在Linux下可以通过命令env查看当前所有的环境变量(注意，约定俗成，环境变量的名称都是全大写的)，常用的有：

-   当前用户名$USER
-   用户主目录$HOME，通常为/home/目录下，与用户名相同；但不全是，如root账号；
-   系统路径$PATH，在shell执行的命令都默认在这些路径下搜索
-   动态链接库路径$LD_LIBRARY_PATH

这里深入介绍一下动态链接库路径。经常在Linux下编译C/C++程序的同学，可能会遇到“undefined reference to xxx”的错误。这个错误指的是链接器(linker)在链接代码时发现某个函数、变量等在所有的object files和库文件中找不到；如果这个reference是自己定义的，请确认Linker命令是否正确；如果是第三方提供的，那就说明Linker在所有指定的目录下都没有找到；而Linker查找的路径，除了链接时通过-L选项显示指定以外，就是通过$LD_LIBRARY_PATH来指定的。

  
Linux下提供了export命令来设定一个新的环境变量，或者修改已有环境变量的内容，如:

- export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/foo/bar/lib  
- 各个路径之间是通过冒号分隔的；  
- 在设置时一定要记得把之前的值保留下来，以免删除了其他路径设置；  
- 直接在命令行上执行上述命令，仅对当前终端有效；  
- 如果需要长期使用，可以将上述命令加入~/.bashrc或/etc/profile，前者对当前用户有效，后者对所有用户有效；上述修改在下次登录后生效；_